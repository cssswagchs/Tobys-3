{% extends "layout.html" %}
{% block title %}Admin Dashboard{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto p-6">
  <div class="flex justify-between items-center mb-6">
    <h1 class="text-3xl font-bold text-gray-800">👑 Admin Dashboard</h1>
    <div class="text-sm text-gray-500">
      Logged in as <span class="font-semibold">{{ session.username }}</span>
    </div>
  </div>

  <!-- System Stats Cards -->
  <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
    <div class="bg-white rounded-lg shadow p-6">
      <h3 class="text-lg font-semibold mb-2 text-gray-700">Users</h3>
      <div class="flex justify-between items-end">
        <span class="text-3xl font-bold text-blue-600">{{ stats.users }}</span>
        <a href="{{ url_for('admin.manage_users') }}" class="text-blue-500 hover:underline">Manage</a>
      </div>
    </div>
    
    <div class="bg-white rounded-lg shadow p-6">
      <h3 class="text-lg font-semibold mb-2 text-gray-700">Harlestons Orders</h3>
      <div class="flex justify-between items-end">
        <div>
          <span class="text-3xl font-bold text-red-600">{{ stats.active_harlestons }}</span>
          <span class="text-sm text-gray-500 ml-1">active</span>
          <span class="text-sm text-gray-400 ml-2">({{ stats.harlestons_orders }} total)</span>
        </div>
        <a href="{{ url_for('harlestons.terminal') }}" class="text-red-500 hover:underline">View</a>
      </div>
    </div>
    
    <div class="bg-white rounded-lg shadow p-6">
      <h3 class="text-lg font-semibold mb-2 text-gray-700">IMM Orders</h3>
      <div class="flex justify-between items-end">
        <div>
          <span class="text-3xl font-bold text-green-600">{{ stats.active_imm }}</span>
          <span class="text-sm text-gray-500 ml-1">active</span>
          <span class="text-sm text-gray-400 ml-2">({{ stats.imm_orders }} total)</span>
        </div>
        <a href="{{ url_for('imm.terminal') }}" class="text-green-500 hover:underline">View</a>
      </div>
    </div>
  </div>

  <!-- Quick Access Buttons -->
  <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
    <a href="{{ url_for('admin.manage_users') }}" class="bg-blue-100 hover:bg-blue-200 text-blue-800 rounded-lg p-4 text-center shadow-sm">
      👥 Manage Users
    </a>
    <a href="{{ url_for('admin.system_info') }}" class="bg-purple-100 hover:bg-purple-200 text-purple-800 rounded-lg p-4 text-center shadow-sm">
      🔧 System Info
    </a>
    <a href="{{ url_for('admin.admin_notes') }}" class="bg-yellow-100 hover:bg-yellow-200 text-yellow-800 rounded-lg p-4 text-center shadow-sm">
      📝 Admin Notes
    </a>
    <a href="{{ url_for('dashboard.index') }}" class="bg-gray-100 hover:bg-gray-200 text-gray-800 rounded-lg p-4 text-center shadow-sm">
      🏠 Main Dashboard
    </a>
  </div>

  <!-- Recent Activity -->
  <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
    <!-- Recent Harlestons Orders -->
    <div class="bg-white rounded-lg shadow overflow-hidden">
      <div class="bg-red-50 px-4 py-3 border-b border-red-100">
        <h3 class="font-semibold text-red-800">Recent Harlestons Orders</h3>
      </div>
      <div class="p-4">
        <table class="min-w-full divide-y divide-gray-200">
          <thead>
            <tr>
              <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">PO #</th>
              <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Club</th>
              <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
            </tr>
          </thead>
          <tbody class="divide-y divide-gray-200">
            {% for order in recent_harlestons %}
            <tr>
              <td class="px-3 py-2 whitespace-nowrap text-sm text-gray-900">{{ order.po_number or 'N/A' }}</td>
              <td class="px-3 py-2 whitespace-nowrap text-sm text-gray-900">{{ order.club_nickname or 'N/A' }}</td>
              <td class="px-3 py-2 whitespace-nowrap text-sm">
                <span class="px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full 
                  {% if order.status == 'Done' %}bg-green-100 text-green-800
                  {% elif 'Inline' in order.status %}bg-yellow-100 text-yellow-800
                  {% else %}bg-blue-100 text-blue-800{% endif %}">
                  {{ order.status or 'N/A' }}
                </span>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
        <div class="mt-3 text-right">
          <a href="{{ url_for('harlestons.terminal') }}" class="text-sm text-red-600 hover:underline">View all orders →</a>
        </div>
      </div>
    </div>

    <!-- Recent IMM Orders -->
    <div class="bg-white rounded-lg shadow overflow-hidden">
      <div class="bg-green-50 px-4 py-3 border-b border-green-100">
        <h3 class="font-semibold text-green-800">Recent IMM Orders</h3>
      </div>
      <div class="p-4">
        <table class="min-w-full divide-y divide-gray-200">
          <thead>
            <tr>
              <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">PO #</th>
              <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Project</th>
              <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
            </tr>
          </thead>
          <tbody class="divide-y divide-gray-200">
            {% for order in recent_imm %}
            <tr>
              <td class="px-3 py-2 whitespace-nowrap text-sm text-gray-900">{{ order.po_number or 'N/A' }}</td>
              <td class="px-3 py-2 whitespace-nowrap text-sm text-gray-900">{{ order.nickname or 'N/A' }}</td>
              <td class="px-3 py-2 whitespace-nowrap text-sm">
                <span class="px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full 
                  {% if order.status == 'Done' %}bg-green-100 text-green-800
                  {% elif 'Inline' in order.status %}bg-yellow-100 text-yellow-800
                  {% else %}bg-blue-100 text-blue-800{% endif %}">
                  {{ order.status or 'N/A' }}
                </span>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
        <div class="mt-3 text-right">
          <a href="{{ url_for('imm.terminal') }}" class="text-sm text-green-600 hover:underline">View all orders →</a>
        </div>
      </div>
    </div>
  </div>

  <!-- User Management Preview -->
  <div class="mt-8 bg-white rounded-lg shadow overflow-hidden">
    <div class="bg-blue-50 px-4 py-3 border-b border-blue-100">
      <h3 class="font-semibold text-blue-800">User Management</h3>
    </div>
    <div class="p-4">
      <table class="min-w-full divide-y divide-gray-200">
        <thead>
          <tr>
            <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Username</th>
            <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Company</th>
            <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Role</th>
            <th class="px-3 py-2 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
          </tr>
        </thead>
        <tbody class="divide-y divide-gray-200">
          {% for user in users %}
          <tr>
            <td class="px-3 py-2 whitespace-nowrap text-sm text-gray-900">{{ user.username }}</td>
            <td class="px-3 py-2 whitespace-nowrap text-sm text-gray-900">{{ user.company or 'N/A' }}</td>
            <td class="px-3 py-2 whitespace-nowrap text-sm">
              <span class="px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full 
                {% if user.role_name == 'admin' %}bg-purple-100 text-purple-800
                {% elif 'admin' in user.role_name %}bg-blue-100 text-blue-800
                {% else %}bg-gray-100 text-gray-800{% endif %}">
                {{ user.role_name }}
              </span>
            </td>
            <td class="px-3 py-2 whitespace-nowrap text-sm text-right">
              <a href="{{ url_for('admin.edit_user', user_id=user.id) }}" class="text-blue-600 hover:text-blue-900 mr-3">Edit</a>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
      <div class="mt-3 text-right">
        <a href="{{ url_for('admin.manage_users') }}" class="text-sm text-blue-600 hover:underline">Manage all users →</a>
      </div>
    </div>
  </div>
</div>
{% endblock %}
